
<!DOCTYPE html>
<html>
<head>
  <title>Travancore Royals Academy</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tab { display: none; }
    .tab-button { margin: 5px; padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; }
    .tab-button.active { background-color: #eee; }
    select, input, button { margin: 5px; padding: 8px; }
  </style>
</head>
<body>
  <h2>Travancore Royals Academy Manager</h2>
  <div>
    <button class="tab-button active" onclick="openTab('attendance')">Attendance</button>
    <button class="tab-button" onclick="openTab('fees')">Fees</button>
  </div>

  <div id="attendance" class="tab" style="display:block;">
    <h3>Mark Attendance</h3>
    <label>Location:</label>
    <select id="att-location" onchange="populatePlayers('att')"></select>
    <label>Player:</label>
    <select id="att-player"></select>
    <label>Status:</label>
    <select id="att-status">
      <option value="Present">Present</option>
      <option value="Absent">Absent</option>
    </select>
    <button onclick="submitAttendance()">Submit</button>
  </div>

  <div id="fees" class="tab">
    <h3>Record Fee</h3>
    <label>Location:</label>
    <select id="fees-location" onchange="populatePlayers('fees')"></select>
    <label>Player:</label>
    <select id="fees-player"></select>
    <label>Month:</label>
    <input type="text" id="fees-month" placeholder="e.g. June">
    <label>Amount:</label>
    <input type="number" id="fees-amount">
    <label>Payment Mode:</label>
    <select id="fees-mode">
      <option value="Cash">Cash</option>
      <option value="UPI">UPI</option>
      <option value="Bank Transfer">Bank Transfer</option>
    </select>
    <button onclick="submitFees()">Submit</button>
  </div>

  <script>
    const webAppBaseUrl = https://script.google.com/macros/s/AKfycbxyWV9TYYAeUijZjqDyrFtMa7gsvJ9OWozWyBMDVRXBXe4DvlgqOcCfe6HeJJGwJIQW/exec

    let playersByLocation = {};

    function openTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.style.display = 'none');
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName).style.display = 'block';
      event.target.classList.add('active');
    }

    function populateDropdowns() {
      fetch(webAppBaseUrl + "?action=getPlayerList")
        .then(response => response.json())
        .then(data => {
          playersByLocation = data;
          const locations = Object.keys(data);
          ['att-location', 'fees-location'].forEach(id => {
            const select = document.getElementById(id);
            select.innerHTML = "";
            locations.forEach(loc => {
              const option = document.createElement('option');
              option.value = loc;
              option.textContent = loc;
              select.appendChild(option);
            });
            populatePlayers(id.split('-')[0]);
          });
        });
    }

    function populatePlayers(type) {
      const location = document.getElementById(`${type}-location`).value;
      const players = playersByLocation[location] || [];
      const playerSelect = document.getElementById(`${type}-player`);
      playerSelect.innerHTML = "";
      players.forEach(player => {
        const option = document.createElement('option');
        option.value = player;
        option.textContent = player;
        playerSelect.appendChild(option);
      });
    }

    function submitAttendance() {
      const data = {
        type: "attendance",
        date: new Date().toISOString().split('T')[0],
        location: document.getElementById("att-location").value,
        player: document.getElementById("att-player").value,
        status: document.getElementById("att-status").value
      };
      fetch(webAppBaseUrl, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      }).then(res => alert("Attendance submitted"));
    }

    function submitFees() {
      const data = {
        type: "fees",
        date: new Date().toISOString().split('T')[0],
        location: document.getElementById("fees-location").value,
        player: document.getElementById("fees-player").value,
        month: document.getElementById("fees-month").value,
        amount: document.getElementById("fees-amount").value,
        mode: document.getElementById("fees-mode").value
      };
      fetch(webAppBaseUrl, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      }).then(res => alert("Fee recorded"));
    }

    window.onload = populateDropdowns;
  </script>
</body>
</html>
